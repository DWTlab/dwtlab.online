<!DOCTYPE html>
<html>
<head>
  <title>://ai</title>
  <style>
     ::-webkit-scrollbar { display: none; }
     @media (-moz-touch-enabled: 0), (pointer: fine) { /* Hide scrollbar for desktop */ html { scrollbar-width: none; } }
    body {
      background-color: #2e2e2e;
      font-family: 'Consolas', 'Lucida Console', 'Courier New', Courier, monospace;
      font-size: 14px;
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: auto;
      flex-grow: 1;
      height: calc(100vh - 100px); /* Minus the height of your input container, adjust as needed */
    }

    .chat-container {
      flex: 1;
      justify-content: center;
      background-color: transparent;
      padding: 10px;
      box-shadow: none;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      max-width: 100%;
      padding-left: 30px;
      padding-right: 30px;
      height: auto; /* This should not be more than 100vh */
      overflow-y: auto;
    }

    .chat-input-container {
      position: sticky; /* Change from fixed to sticky */
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .chat-input {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3px;
      width: 75%;
      margin: 20px auto;
      /*background-color: #2e2e2e00;*/
      max-width: 100%;
    }

    .chat-input input {
      border: none;
      border-radius: 3px;
      padding: 10px;
      background-color: #555;
      color: #fff;
      width: 600px;
      text-align: center;
      outline: none;
      font-size: 11px;
      margin-right: 10px;
      max-width: 100%; /* Added max-width to occupy full container width */
    }

    .chat-input button {
      border: none;
      background-color: #555;
      cursor: pointer;
      width: 25px;
      height: 25px;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      color: #333;
    }

    .chat-input button::after {
      content: "/";
      color: #fff;
    }

    .chat-messages {
      font-family: 'Consolas', 'Lucida Console', 'Courier New', Courier, monospace;
      font-size: 11px;
      width: 100%;
      max-width: 100%; /* Added max-width to occupy full container width */
    }

    .chat-message {
      padding: 10px;
      border-radius: 3px;
      margin-bottom: 10px;
      font-family: 'Consolas', 'Lucida Console', 'Courier New', Courier, monospace;
      font-size: 11px;
      max-width: 100%;
      width: fit-content; /* Added width: fit-content to make message width adjust to content */
    }

    .user-message {
      background-color: #444;
    }

    .ai-message {
      background-color: #555;
    }

    .footer-container {
      display: flex;
      justify-content: center;
      padding: 0px;
      position: fixed;
      bottom: 0;
      z-index: 99;
      width: 100%;
    }

    .footer {
      display: flex;
      font-size: 11px;
    }

    .hotlink {
      margin: 10px;
      padding: 1px;
      background-color: #2e2e2e;
      color: #777;
      text-decoration: none;
      font-weight: none;
      border-radius: 5px;
      transition: background-color 0.4s ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .hotlink:hover {
      background-color: #222222;
    }

  </style>
</head>
<body>
  <div class="main-container">
    <div class="chat-container">
      <div class="chat-messages"></div>
    </div>
  </div>

  <div class="chat-input-container">
    <div class="chat-input">
      <input type="text" placeholder="">
      <button></button>
    </div>
  </div>

  <div class="footer-container">
    <div class="footer">
      <a class="hotlink" href="https://dwtlab.online/6"></a>
      <a class="hotlink" href="https://dwtlab.online/index">1</a>
      <a class="hotlink" href="https://dwtlab.online/2">2</a>
      <a class="hotlink" href="https://dwtlab.online/ai">ai</a>
      <a class="hotlink" href="https://dwtlab.online/6"></a>
    </div>
  </div>

  <script type="module">
    import { config } from './int/config.js';
  
    const chatEndpoint = 'https://dwtgpt.dwtlab.workers.dev';
  
    let conversation = [
      { role: 'system', content: config.initialPrompt }
    ];

    function sendMessage() {
      const input = document.querySelector('.chat-input input');
      const message = input.value.trim();

      if (message === '') {
        return;
      }

      conversation.push({ role: 'user', content: message });
      input.value = ''; // Clear input box immediately after sending message
      input.focus(); // Focus on the input field after sending a message

      fetch(chatEndpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ messages: conversation }),
      })
        .then((response) => response.json())
        .then((data) => {
          displayMessage(message, 'user');
          displayMessage(data.response, 'ai');
          conversation.push({ role: 'assistant', content: data.response });
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }

    function displayMessage(message, role) {
      const chatMessages = document.querySelector('.chat-messages');
      const messageElement = document.createElement('div');
      messageElement.classList.add('chat-message', role === 'user' ? 'user-message' : 'ai-message');

      const contentElement = document.createElement('div');
      contentElement.textContent = message;
      messageElement.appendChild(contentElement);

      chatMessages.appendChild(messageElement);

      // Delay the scroll to ensure the new message has rendered
      setTimeout(scrollToBottom, 0);
    }

    function scrollToBottom() {
      const chatContainer = document.querySelector('.chat-container');
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    document.querySelector('.chat-input button').addEventListener('click', sendMessage);
    document.querySelector('.chat-input input').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

  </script>


</body>
</html>
